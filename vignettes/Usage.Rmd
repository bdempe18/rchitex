---
title: "The Master Rchitext"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Usage}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, echo = FALSE}
suppressPackageStartupMessages(library(rchitex))
```

RCHITEX provides an extensive set of options allowing users to generate and output nicely formatted text tables wiles simultaneously outputting the equivalent Latex code to a provided path. rchitex is intended to bridge the gap between statistical exploration in R and article writing.

## Regression output

At its most core functionality, `build` converts a list of regression models to elegantly formatted text output. If an output path is not provided and md (standing for markdown) is set to its default value of null, a simple text representation of the data is printed to the console. 


```{r overviewEx}
# Example data
data('freeny')
mod <- lm(y ~ lag.quarterly.revenue + price.index + income.level + 
            market.potential, data = freeny)
mod2 <- lm(y ~ lag.quarterly.revenue + price.index + income.level, 
           data = freeny)

build(mod, mod2)

```

### Saving Latex files

Providing a filepath to the path parameter will simultaneously save a Latex representation of the regression table to the provided filepath. By default, rchitex will still output a text representation of the table. This can be suppressed by setting `silent` to TRUE

By default, rchitex saves the latex table as a tabular object. Setting the `as_table` parameter to TRUE wraps the tabular object in a table. To produce a landscaped table, set the `landscape` parameter to TRUE. Note that if a table is landscaped, you must add the line "usepackage{lscape}" to your Latex preamble.  

A Latex label can be added by specifying a `label` parameter.

``` {r texSav, eval=FALSE} 
fp <- paste(getwd(),'myTable.tex')
label='fig:reg'
build(mod, mod2, path=fp, sep='/'),
      silent=TRUE, as_table=TRUE, label=label)
```
### Markdown output

The text output can be replaced with either latex or html output. This allows knitr to directly format the table when used in conjunction with RMarkdown. Note that in this case, the results argument in the markdown chunk needs to be set to 'asis'. 

```{r htmlOverview, results='asis'}
build(mod, mod2, md = 'html')
```

### Variable Names

Variable names can be customized by passing a list associating variable names with the desired output format. 

```{r formatting, results='asis'}
id_names <- list('price.index' = 'Price index',
                 'income.level' = 'Income level',
                 'market.potential' = 'Market potential',
                 'lag.quarterly.revenue' = 'Lagged rev')
```

### Level of significance 

Both the p-value cutoffs for significance and the symbols used can be customized by passing a list of symbols and cut-offs as the `sig` argument. Each symbol must be associated
with a valid numeric p value cutoff between 0 and 1. The list must be decreasing in significance. 

``` {r sig, results='asis'}
  sig <- list('!' = 0.03,
              '**'  = 0.045,
              '*'   = 0.1,
              ':)'   = 0.5)
```

### Titles and notes

Default table names can be overwritten by providing a `title` parameter. Likewise, short notes can be displayed at the bottom of the table by passing a string to the `note` parameter.

``` {r titleNotes, results='asis'}
  title <-'Goofy table'
  note <-  'My note'
  build(mod, mod2, indep_names=id_names, md='html', sig=sig,
      title=title, note=note)
```  

### Addition fit characteristics

Rchitex allows for simple customization of the fit characteristics at the bottom of the regression table. For example, a linear model will list of the number of observations, R2, adjusted R2, and F statistic by default. Fit characteristics can be reordered and excluded through the `stats` parameter. Each fit characteristic has a letter designation. 

* c = Akaike Information Criterion
* f = F statistic
* a = Adjusted R2
* r = R2
* o = Number of observations
* l = Log likelihood

To customize the fit listing, a single string of characters needs to be passed to the `stats` parameter. For example, if you want just want to list the R2 and number of observations in that order, set `stats = "ro"`.

You may also provide your own lists to be included in the fit characterization section. A list must be passed to the `pre_stats` parameter where the name of each list element is the intended label and the value is a vector of values to be outputted. The size of the vector should be the number of models in the table.

```{r pre_stats, results='asis'}
stats = 'ro'
pre_stats <- list("Full sample" = c("Yes", "No"))

  build(mod, mod2, indep_names=id_names, md='html', sig=sig,
      title=title, note=note, stats=stats, pre_stats=pre_stats)
```

## Descriptive statistics

Tables of descriptive statistics are produced with the `describe` method. A single data frame or tibble needs to be passed as the `data` parameter. Generally all features available to `build` as also available to `describe`. Either a text, html, or latex table will be outputted to the console while a latex file is written to a specified file. 

``` {r descriptive, results='asis'}
df <- data.frame("first" = c(4,5,6), "second" = c(7,5,3))
describe(df, md='html')
```

### Self-defined functions

`describe` has the additional ability to summarize tables with self-defined functions. By default, `describe` outputs the number of observations, mean, standard deviation, minimum, and maximum of each column. Self-defined or alternative descriptive functions can be also be applied by over-riding the default `statistics` argument. Note that each function must be able to compress a vector of numbers into a single summary statistic. Customizing the `statistics` parameter also lets the user define the name of each column as well as the order of functions.

```{r descriptive_functions, results='asis'}
funcs <- list('#' = length, 
              foo = function(x) sum(x) / rnorm(1), 
              answer = function(x) 42)
describe(df, md='html', statistics = funcs)
```


## Creating an appendix

rchitex automates the process of generating lengthy appendices in LaTeX. The `appendize` function accepts a number of rchitex or ggplot objects, saves the tables and plots to a local drive, and produces an *appendix.tex* file at the top of the file tree. The resulting Latex appendix is a section in which each table or plot is printed on its own page.

Along with rchitex objects, `appendize` can handle ggplots. If a raw ggplot object is passed in, a random file name and Latex label is created. To customize the Latex figure from rchitex, the ggplot object needs to be wrapped in `gg_tex`. The `gg_tex` wrapper allows you to specify a Latex caption and label.

```{r appendix, eval=FALSE}
tex1 <- build(mod, label='f1', silent=TRUE, landscape=T)
tex2 <- build(mod2, label='f2', silent=TRUE)

raw_gg <- ggplot(data=df) + geom_point(aes(x=first, y=second))
wrapped_gg <- gg_tex(raw_gg, label="fig:simple", caption="Simple Plot")

appendize(tex1, tex2, raw_gg, wrapped_gg)
```
